<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Basic &mdash; Mixture Mapping alpha documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/mixturemapping.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/sphinx_highlight.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Mixture Mapping" href="mixturemapping.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> Mixture Mapping
          </a>
              <div class="version">
                0.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="mixturemapping.html">Mixture Mapping</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="mixturemapping.html#layers">Layers</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">Basic</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#mixturemapping.layers.covmatrix.TrainableCovMatrix"><code class="docutils literal notranslate"><span class="pre">TrainableCovMatrix</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#mixturemapping.layers.distribution.Distribution"><code class="docutils literal notranslate"><span class="pre">Distribution</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#mixturemapping.layers.distribution.DistributionMean"><code class="docutils literal notranslate"><span class="pre">DistributionMean</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#mixturemapping.layers.distribution.DistributionSampleLoss"><code class="docutils literal notranslate"><span class="pre">DistributionSampleLoss</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#mixturemapping.layers.distribution.DistributionSamples"><code class="docutils literal notranslate"><span class="pre">DistributionSamples</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#module-mixturemapping.layers.linearmapping">Mapping</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#mixturemapping.layers.linearmapping.LinearMapping"><code class="docutils literal notranslate"><span class="pre">LinearMapping</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#mixturemapping.layers.generalmapping.GeneralMapping"><code class="docutils literal notranslate"><span class="pre">GeneralMapping</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#module-mixturemapping.layers.binyield">Binning</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#mixturemapping.layers.binyield.BinYield"><code class="docutils literal notranslate"><span class="pre">BinYield</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#module-mixturemapping.layers.gmrmapping">Gaussian Mixtures</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#mixturemapping.layers.gmrmapping.ConstGMR"><code class="docutils literal notranslate"><span class="pre">ConstGMR</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#mixturemapping.layers.gmrmapping.DynamicGMR"><code class="docutils literal notranslate"><span class="pre">DynamicGMR</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="mixturemapping.html#module-mixturemapping.distributions">Distributions</a></li>
<li class="toctree-l2"><a class="reference internal" href="mixturemapping.html#module-mixturemapping.utils">Utils</a></li>
<li class="toctree-l2"><a class="reference internal" href="mixturemapping.html#module-mixturemapping.binning">Binning</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Mixture Mapping</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a></li>
          <li class="breadcrumb-item"><a href="mixturemapping.html">Mixture Mapping</a></li>
      <li class="breadcrumb-item active">Basic</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/mixturemapping.layers.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="module-mixturemapping.layers.covmatrix">
<span id="basic"></span><h1>Basic<a class="headerlink" href="#module-mixturemapping.layers.covmatrix" title="Permalink to this heading"></a></h1>
<dl class="py class">
<dt class="sig sig-object py" id="mixturemapping.layers.covmatrix.TrainableCovMatrix">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">TrainableCovMatrix</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mixturemapping.layers.covmatrix.TrainableCovMatrix" title="Permalink to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">Layer</span></code></p>
<p>Generates an independently trainable covariance matrix</p>
<p>Important symmetry properties are generated automatically because the covariance matrix
is built up from standard deviations <cite>TrainableCovMatrix.spread</cite>
and correlations <cite>TrainableCovMatrix.corr</cite>.</p>
<dl class="simple">
<dt>Params:</dt><dd><p>output</p>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="mixturemapping.layers.covmatrix.TrainableCovMatrix.build">
<span class="sig-name descname"><span class="pre">build</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">input_shapes</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mixturemapping.layers.covmatrix.TrainableCovMatrix.build" title="Permalink to this definition"></a></dt>
<dd><p>Creates the variables of the layer (optional, for subclass implementers).</p>
<p>This is a method that implementers of subclasses of <cite>Layer</cite> or <cite>Model</cite>
can override if they need a state-creation step in-between
layer instantiation and layer call. It is invoked automatically before
the first execution of <cite>call()</cite>.</p>
<p>This is typically used to create the weights of <cite>Layer</cite> subclasses
(at the discretion of the subclass implementer).</p>
<dl class="simple">
<dt>Args:</dt><dd><dl class="simple">
<dt>input_shape: Instance of <cite>TensorShape</cite>, or list of instances of</dt><dd><p><cite>TensorShape</cite> if the layer expects a list of inputs
(one instance per input).</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mixturemapping.layers.covmatrix.TrainableCovMatrix.call">
<span class="sig-name descname"><span class="pre">call</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mixturemapping.layers.covmatrix.TrainableCovMatrix.call" title="Permalink to this definition"></a></dt>
<dd><p>This is where the layer’s logic lives.</p>
<p>The <cite>call()</cite> method may not create state (except in its first invocation,
wrapping the creation of variables or other resources in <cite>tf.init_scope()</cite>).
It is recommended to create state in <cite>__init__()</cite>, or the <cite>build()</cite> method
that is called automatically before <cite>call()</cite> executes the first time.</p>
<dl>
<dt>Args:</dt><dd><dl>
<dt>inputs: Input tensor, or dict/list/tuple of input tensors.</dt><dd><p>The first positional <cite>inputs</cite> argument is subject to special rules:
- <cite>inputs</cite> must be explicitly passed. A layer cannot have zero</p>
<blockquote>
<div><p>arguments, and <cite>inputs</cite> cannot be provided via the default value
of a keyword argument.</p>
</div></blockquote>
<ul class="simple">
<li><p>NumPy array or Python scalar values in <cite>inputs</cite> get cast as tensors.</p></li>
<li><p>Keras mask metadata is only collected from <cite>inputs</cite>.</p></li>
<li><p>Layers are built (<cite>build(input_shape)</cite> method)
using shape info from <cite>inputs</cite> only.</p></li>
<li><p><cite>input_spec</cite> compatibility is only checked against <cite>inputs</cite>.</p></li>
<li><p>Mixed precision input casting is only applied to <cite>inputs</cite>.
If a layer has tensor arguments in <cite>*args</cite> or <cite>**kwargs</cite>, their
casting behavior in mixed precision should be handled manually.</p></li>
<li><p>The SavedModel input specification is generated using <cite>inputs</cite> only.</p></li>
<li><p>Integration with various ecosystem packages like TFMOT, TFLite,
TF.js, etc is only supported for <cite>inputs</cite> and not for tensors in
positional and keyword arguments.</p></li>
</ul>
</dd>
<dt><a href="#id1"><span class="problematic" id="id2">*</span></a>args: Additional positional arguments. May contain tensors, although</dt><dd><p>this is not recommended, for the reasons above.</p>
</dd>
<dt><a href="#id3"><span class="problematic" id="id4">**</span></a>kwargs: Additional keyword arguments. May contain tensors, although</dt><dd><p>this is not recommended, for the reasons above.
The following optional keyword arguments are reserved:
- <cite>training</cite>: Boolean scalar tensor of Python boolean indicating</p>
<blockquote>
<div><p>whether the <cite>call</cite> is meant for training or inference.</p>
</div></blockquote>
<ul class="simple">
<li><p><cite>mask</cite>: Boolean input mask. If the layer’s <cite>call()</cite> method takes a
<cite>mask</cite> argument, its default value will be set to the mask generated
for <cite>inputs</cite> by the previous layer (if <cite>input</cite> did come from a layer
that generated a corresponding mask, i.e. if it came from a Keras
layer with masking support).</p></li>
</ul>
</dd>
</dl>
</dd>
<dt>Returns:</dt><dd><p>A tensor or list/tuple of tensors.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mixturemapping.layers.covmatrix.TrainableCovMatrix.compute_output_shape">
<span class="sig-name descname"><span class="pre">compute_output_shape</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">input_shape</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mixturemapping.layers.covmatrix.TrainableCovMatrix.compute_output_shape" title="Permalink to this definition"></a></dt>
<dd><p>Computes the output shape of the layer.</p>
<p>This method will cause the layer’s state to be built, if that has not
happened before. This requires that the layer will later be used with
inputs that match the input shape provided here.</p>
<dl class="simple">
<dt>Args:</dt><dd><dl class="simple">
<dt>input_shape: Shape tuple (tuple of integers)</dt><dd><p>or list of shape tuples (one per output tensor of the layer).
Shape tuples can include None for free dimensions,
instead of an integer.</p>
</dd>
</dl>
</dd>
<dt>Returns:</dt><dd><p>An input shape tuple.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mixturemapping.layers.covmatrix.TrainableCovMatrix.get_config">
<span class="sig-name descname"><span class="pre">get_config</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#mixturemapping.layers.covmatrix.TrainableCovMatrix.get_config" title="Permalink to this definition"></a></dt>
<dd><p>Returns the config of the layer.</p>
<p>A layer config is a Python dictionary (serializable)
containing the configuration of a layer.
The same layer can be reinstantiated later
(without its trained weights) from this configuration.</p>
<p>The config of a layer does not include connectivity
information, nor the layer class name. These are handled
by <cite>Network</cite> (one layer of abstraction above).</p>
<p>Note that <cite>get_config()</cite> does not guarantee to return a fresh copy of dict
every time it is called. The callers should make a copy of the returned dict
if they want to modify it.</p>
<dl class="simple">
<dt>Returns:</dt><dd><p>Python dictionary.</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<span class="target" id="module-mixturemapping.layers.distribution"></span><dl class="py class">
<dt class="sig sig-object py" id="mixturemapping.layers.distribution.Distribution">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">Distribution</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mixturemapping.layers.distribution.Distribution" title="Permalink to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">Layer</span></code></p>
<p>Create a keras layer with a gaussian mixture distribution.</p>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>distParams = {&quot;means&quot;: ???, &quot;covariances&quot;: ???, &quot;weights&quot;: ???}
distLayer = mm.layers.Distribution(regularize_cov_epsilon=0.95)
dist = distLayer(distParams)
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>regularize_cov_epsilon</strong> (<em>float</em>) – Strength of the regularization of
the covarainz matrix. Without regularization, the matrices
can become  non-invertible.</p>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="mixturemapping.layers.distribution.Distribution.build">
<span class="sig-name descname"><span class="pre">build</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">input_shapes</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mixturemapping.layers.distribution.Distribution.build" title="Permalink to this definition"></a></dt>
<dd><p>Creates the the dist layer.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>input_shapes</strong> (<em>dict inputs</em>) – <p>???</p>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mixturemapping.layers.distribution.Distribution.call">
<span class="sig-name descname"><span class="pre">call</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mixturemapping.layers.distribution.Distribution.call" title="Permalink to this definition"></a></dt>
<dd><p>Constructs a Gaussian mixture distribution based
on <cite>x</cite> (dict of <cite>tf.Tensors</cite>)</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>means</strong> (<em>tf.Tensor</em><em> [</em><em>batch</em><em>, </em><em>mix</em><em>, </em><em>inDim</em><em>]</em>) – Means <cite>tf.Tensor</cite> of the mixture distribution</p></li>
<li><p><strong>covariances</strong> (<em>tf.Tensor</em><em> [</em><em>batch</em><em>, </em><em>mix</em><em>, </em><em>inDim</em><em>, </em><em>inDim</em><em>]</em>) – Cov Matrix Tensor of the mixture distribution</p></li>
<li><p><strong>weights</strong> (<em>tf.Tensor</em><em> [</em><em>batch</em><em>, </em><em>mix</em><em>]</em>) – Weight <cite>tf.Tensor</cite> ot the mixture components</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>The gaussian mixture distribution</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>tfp.distributions.Distribution</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mixturemapping.layers.distribution.Distribution.compute_output_shape">
<span class="sig-name descname"><span class="pre">compute_output_shape</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">input_shape</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mixturemapping.layers.distribution.Distribution.compute_output_shape" title="Permalink to this definition"></a></dt>
<dd><p>Computes the output shape of the layer.</p>
<p>If the layer has not been built, this method will call build on
the layer. This assumes that the layer will later be used with
inputs that match the input shape provided here.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>input_shape</strong> – Shape tuple (tuple of integers) or list of
shape tuples (one per output tensor of the layer).
Shape tuples can include None for free dimensions,
instead of an integer.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>The output shape tuple.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>tuple</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mixturemapping.layers.distribution.Distribution.get_config">
<span class="sig-name descname"><span class="pre">get_config</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#mixturemapping.layers.distribution.Distribution.get_config" title="Permalink to this definition"></a></dt>
<dd><p>Returns the configuration of the layer.</p>
<p>A layer config is a Python dictionary (serializable) containing
the configuration of a layer. The same layer can be reinstantiated
later (without its trained weights) from this configuration.</p>
<p>The config of a layer does not include connectivity information,
nor the layer class name. These are handled by Network (one layer
of abstraction above).</p>
<p>Note that get_config() does not guarantee to return a fresh copy
of dict every time it is called. The callers should make a copy
of the returned dict if they want to modify it.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>Python dictionary.</p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>dict</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="mixturemapping.layers.distribution.DistributionMean">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">DistributionMean</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mixturemapping.layers.distribution.DistributionMean" title="Permalink to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">Layer</span></code></p>
<p>Create a keras layer to extract the mean of a distribution</p>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>distParams = {&quot;means&quot;: ???, &quot;covariances&quot;: ???, &quot;weights&quot;: ???}
distLayer = mm.layers.Distribution(regularize_cov_epsilon=0.95)
dist = distLayer(distParams)

mean = mm.layers.DistributionMean()(dist)
</pre></div>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="mixturemapping.layers.distribution.DistributionMean.call">
<span class="sig-name descname"><span class="pre">call</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mixturemapping.layers.distribution.DistributionMean.call" title="Permalink to this definition"></a></dt>
<dd><p>Compute a sample based loss and add it to the model loss</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>x</strong> – Distribution</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>means</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="mixturemapping.layers.distribution.DistributionSampleLoss">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">DistributionSampleLoss</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mixturemapping.layers.distribution.DistributionSampleLoss" title="Permalink to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">Layer</span></code></p>
<p>Create a keras layer to compute the distribution loss</p>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>distParams = {&quot;means&quot;: ???, &quot;covariances&quot;: ???, &quot;weights&quot;: ???}
distLayer = mm.layers.Distribution(regularize_cov_epsilon=0.95)
dist = distLayer(distParams)

lossdist = mm.layers.DistributionSampleLoss()({&quot;dist&quot;: dist, &quot;samples&quot;: inTsamples})
</pre></div>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="mixturemapping.layers.distribution.DistributionSampleLoss.call">
<span class="sig-name descname"><span class="pre">call</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mixturemapping.layers.distribution.DistributionSampleLoss.call" title="Permalink to this definition"></a></dt>
<dd><p>Compute a sample based loss and add it to the model loss</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>dist</strong> – Distribution</p></li>
<li><p><strong>sample</strong> – Samplepoints</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>distribution</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="mixturemapping.layers.distribution.DistributionSamples">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">DistributionSamples</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mixturemapping.layers.distribution.DistributionSamples" title="Permalink to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">Layer</span></code></p>
<p>Create a keras layer to compute distribution samples</p>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>distParams = {&quot;means&quot;: ???, &quot;covariances&quot;: ???, &quot;weights&quot;: ???}
distLayer = mm.layers.Distribution()
dist = distLayer(distParams)

sampleLayer = mm.layers.DistributionSamples(1000)(dist)
samples = sampleLayer(dist)
</pre></div>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="mixturemapping.layers.distribution.DistributionSamples.call">
<span class="sig-name descname"><span class="pre">call</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mixturemapping.layers.distribution.DistributionSamples.call" title="Permalink to this definition"></a></dt>
<dd><p>Compute samples for a mixture distribution</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>x</strong> – Distribution</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>sample points</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mixturemapping.layers.distribution.DistributionSamples.get_config">
<span class="sig-name descname"><span class="pre">get_config</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#mixturemapping.layers.distribution.DistributionSamples.get_config" title="Permalink to this definition"></a></dt>
<dd><p>Returns the configuration of the layer.</p>
<p>A layer config is a Python dictionary (serializable) containing
the configuration of a layer. The same layer can be reinstantiated
later (without its trained weights) from this configuration.</p>
<p>The config of a layer does not include connectivity information,
nor the layer class name. These are handled by Network (one layer
of abstraction above).</p>
<p>Note that get_config() does not guarantee to return a fresh copy
of dict every time it is called. The callers should make a copy
of the returned dict if they want to modify it.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>Python dictionary.</p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>dict</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</section>
<section id="module-mixturemapping.layers.linearmapping">
<span id="mapping"></span><h1>Mapping<a class="headerlink" href="#module-mixturemapping.layers.linearmapping" title="Permalink to this heading"></a></h1>
<dl class="py class">
<dt class="sig sig-object py" id="mixturemapping.layers.linearmapping.LinearMapping">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">LinearMapping</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mixturemapping.layers.linearmapping.LinearMapping" title="Permalink to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">_Mapping</span></code></p>
<p>A free linear mapping layer, that maps centers and distributions independently.</p>
<p>This layers can be used if the relationship between input distributions
and output distributions is free and linear</p>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mixturemapping</span> <span class="k">as</span> <span class="nn">mm</span>  
<span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>

<span class="n">inMeans</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Input</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">mixN</span><span class="p">,</span> <span class="n">inputMixM</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Means&quot;</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dataType</span><span class="p">)</span>
<span class="n">inStdDevs</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Input</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">mixN</span><span class="p">,</span> <span class="n">inputMixM</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;StdDevs&quot;</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dataType</span><span class="p">)</span>
<span class="n">inWeight</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Input</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">mixN</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Weights&quot;</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dataType</span><span class="p">)</span>

<span class="n">mappingLayer</span> <span class="o">=</span> <span class="n">mm</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">LinearMapping</span><span class="p">(</span><span class="n">outputMixM</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Mapping&quot;</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dataType</span><span class="p">)</span>
<span class="n">newDist</span> <span class="o">=</span> <span class="n">mappingLayer</span><span class="p">({</span><span class="s1">&#39;means&#39;</span><span class="p">:</span> <span class="n">inMeans</span><span class="p">,</span> <span class="s1">&#39;stdDevs&#39;</span><span class="p">:</span> <span class="n">inStdDevs</span><span class="p">,</span> <span class="s1">&#39;weights&#39;</span><span class="p">:</span> <span class="n">inWeight</span><span class="p">})</span>

<span class="n">distLayer</span> <span class="o">=</span> <span class="n">mm</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Distribution</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="n">dataType</span><span class="p">,</span> <span class="n">regularize_cov_epsilon</span><span class="o">=</span><span class="mf">0.95</span><span class="p">)</span>
<span class="n">dist</span> <span class="o">=</span> <span class="n">distLayer</span><span class="p">(</span><span class="n">newDist</span><span class="p">)</span>
</pre></div>
</div>
<section id="parameters">
<h2>Parameters<a class="headerlink" href="#parameters" title="Permalink to this heading"></a></h2>
<dl class="simple">
<dt>regularize_cov_epsilon<span class="classifier">python float</span></dt><dd><p>if not None cov matrix corelation is restricted (eg. 0.995)</p>
</dd>
</dl>
</section>
<section id="returns">
<h2>Returns<a class="headerlink" href="#returns" title="Permalink to this heading"></a></h2>
<dl class="simple">
<dt>{</dt><dd><dl class="simple">
<dt>“means”<span class="classifier">Tensorflow Tensor</span></dt><dd><p>Centers of the mixture distributions</p>
</dd>
<dt>“covariances”<span class="classifier">Tensorflow Tensor</span></dt><dd><p>Covariance matrices of the distributions</p>
</dd>
<dt>“weights”<span class="classifier">Tensorflow Tensor</span></dt><dd><p>Weights of the mixture components</p>
</dd>
</dl>
</dd>
</dl>
<p>}</p>
<dl class="py method">
<dt class="sig sig-object py" id="mixturemapping.layers.linearmapping.LinearMapping.build">
<span class="sig-name descname"><span class="pre">build</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">input_shapes</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mixturemapping.layers.linearmapping.LinearMapping.build" title="Permalink to this definition"></a></dt>
<dd><p>Creates the variables of the layer (optional, for subclass implementers).</p>
<p>This is a method that implementers of subclasses of <cite>Layer</cite> or <cite>Model</cite>
can override if they need a state-creation step in-between
layer instantiation and layer call. It is invoked automatically before
the first execution of <cite>call()</cite>.</p>
<p>This is typically used to create the weights of <cite>Layer</cite> subclasses
(at the discretion of the subclass implementer).</p>
<dl class="simple">
<dt>Args:</dt><dd><dl class="simple">
<dt>input_shape: Instance of <cite>TensorShape</cite>, or list of instances of</dt><dd><p><cite>TensorShape</cite> if the layer expects a list of inputs
(one instance per input).</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mixturemapping.layers.linearmapping.LinearMapping.call">
<span class="sig-name descname"><span class="pre">call</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mixturemapping.layers.linearmapping.LinearMapping.call" title="Permalink to this definition"></a></dt>
<dd><p>Compute the output distribution layer based on <cite>x</cite> (dict of <cite>tf.Tensors</cite>)</p>
<dl class="simple">
<dt>Parameters:</dt><dd><dl class="simple">
<dt>means: Instance of <cite>tf.Tensor</cite></dt><dd><p>Means <cite>tf.Tensor</cite> of the input mixture distribution
shape: [batch, mix, inDim]</p>
</dd>
<dt>stdDevs: Instance of <cite>tf.Tensor</cite></dt><dd><p>Std Deviation <cite>tf.Tensor</cite> of the input mixture distribution
shape: [batch, mix, inDim]</p>
</dd>
<dt>weights: Instance of <cite>tf.Tensor</cite></dt><dd><p>Weight <cite>tf.Tensor</cite> ot the mixture components
shape: [batch, mix]</p>
</dd>
<dt>covA: Instance of <cite>tf.Tensor</cite> [optional]</dt><dd><p>Optional Covariance Matrix to increase distribution spread
shape: [batch, mix, outDim, outDim] if effect is mixture dependent
shape: [batch, outDim, outDim] if effect is mixture independent</p>
</dd>
<dt>covB: Instance of <cite>tf.Tensor</cite> [optional]</dt><dd><p>Second Optional Covariance Matrix to increase distribution spread
shape: [batch, mix, outDim, outDim] if effect is mixture dependent
shape: [batch, outDim, outDim] if effect is mixture independent</p>
</dd>
</dl>
</dd>
<dt>Returns:</dt><dd><dl class="simple">
<dt>means: Instance of <cite>tf.Tensor</cite></dt><dd><p>Means <cite>tf.Tensor</cite> of the output mixture distribution
shape: [batch, mix, outDim]</p>
</dd>
<dt>covariances: Instance of <cite>tf.Tensor</cite></dt><dd><p>Covariance matrix <cite>tf.Tensor</cite> of the output mixture distribution
shape: [batch, mix, outDim, outDim]</p>
</dd>
<dt>weights: Instance of <cite>tf.Tensor</cite></dt><dd><p>Weight <cite>tf.Tensor</cite> ot the mixture components
shape: [batch, mix]</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

</section>
</dd></dl>

<span class="target" id="module-mixturemapping.layers.generalmapping"></span><dl class="py class">
<dt class="sig sig-object py" id="mixturemapping.layers.generalmapping.GeneralMapping">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">GeneralMapping</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mixturemapping.layers.generalmapping.GeneralMapping" title="Permalink to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">_Mapping</span></code></p>
<p>A free general mapping layer, that maps centers and distributions independently.</p>
<p>This layers can be used if the relationship between input distributions
and output distributions is free and general</p>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mixturemapping</span> <span class="k">as</span> <span class="nn">mm</span>  
<span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>

<span class="n">inMeans</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Input</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">mixN</span><span class="p">,</span> <span class="n">inputMixM</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Means&quot;</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dataType</span><span class="p">)</span>
<span class="n">inStdDevs</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Input</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">mixN</span><span class="p">,</span> <span class="n">inputMixM</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;StdDevs&quot;</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dataType</span><span class="p">)</span>
<span class="n">inWeight</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Input</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">mixN</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Weights&quot;</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dataType</span><span class="p">)</span>

<span class="n">mapModel</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Sequential</span><span class="p">()</span>
<span class="n">mapModel</span><span class="o">.</span><span class="n">add</span><span class="p">(</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s2">&quot;relu&quot;</span><span class="p">,</span> <span class="n">kernel_regularizer</span><span class="o">=</span><span class="n">regularizers</span><span class="o">.</span><span class="n">l2</span><span class="p">(</span><span class="mf">0.001</span><span class="p">))</span> <span class="p">)</span>
<span class="n">mapModel</span><span class="o">.</span><span class="n">add</span><span class="p">(</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s2">&quot;relu&quot;</span><span class="p">,</span> <span class="n">kernel_regularizer</span><span class="o">=</span><span class="n">regularizers</span><span class="o">.</span><span class="n">l2</span><span class="p">(</span><span class="mf">0.001</span><span class="p">))</span> <span class="p">)</span>
<span class="n">mapModel</span><span class="o">.</span><span class="n">add</span><span class="p">(</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="n">outputMixM</span><span class="p">))</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">mapModel</span><span class="p">(</span><span class="n">inMeans</span><span class="p">)</span>

<span class="n">deltaModel</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Sequential</span><span class="p">()</span>
<span class="n">deltaModel</span><span class="o">.</span><span class="n">add</span><span class="p">(</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s2">&quot;relu&quot;</span><span class="p">,</span> <span class="n">kernel_regularizer</span><span class="o">=</span><span class="n">regularizers</span><span class="o">.</span><span class="n">l2</span><span class="p">(</span><span class="mf">0.001</span><span class="p">))</span> <span class="p">)</span>
<span class="n">deltaModel</span><span class="o">.</span><span class="n">add</span><span class="p">(</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s2">&quot;relu&quot;</span><span class="p">,</span> <span class="n">kernel_regularizer</span><span class="o">=</span><span class="n">regularizers</span><span class="o">.</span><span class="n">l2</span><span class="p">(</span><span class="mf">0.001</span><span class="p">))</span> <span class="p">)</span>
<span class="n">deltaModel</span><span class="o">.</span><span class="n">add</span><span class="p">(</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="n">outputMixM</span><span class="p">))</span>
<span class="n">yDelta</span> <span class="o">=</span> <span class="n">deltaModel</span><span class="p">(</span><span class="n">inMeans</span><span class="p">)</span>

<span class="n">covALayer</span> <span class="o">=</span> <span class="n">mm</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">TrainableCovMatrix</span><span class="p">(</span><span class="n">outputMixM</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;CovA&quot;</span><span class="p">)</span>
<span class="n">covA</span> <span class="o">=</span> <span class="n">covALayer</span><span class="p">(</span><span class="n">inMeans</span><span class="p">)</span>

<span class="n">mapLayer</span> <span class="o">=</span> <span class="n">mm</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">GeneralMapping</span><span class="p">(</span><span class="n">outputMixM</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Mapping&quot;</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dataType</span><span class="p">)</span>
<span class="n">newDist</span> <span class="o">=</span> <span class="n">mapLayer</span><span class="p">({</span><span class="s1">&#39;means&#39;</span><span class="p">:</span> <span class="n">inMeans</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span><span class="n">y</span><span class="p">,</span> <span class="s1">&#39;yDelta&#39;</span><span class="p">:</span><span class="n">yDelta</span><span class="p">,</span> <span class="s1">&#39;stdDevs&#39;</span><span class="p">:</span> <span class="n">inStdDevs</span><span class="p">,</span> <span class="s1">&#39;weights&#39;</span><span class="p">:</span> <span class="n">inWeight</span><span class="p">,</span> <span class="s1">&#39;covA&#39;</span><span class="p">:</span> <span class="n">covA</span><span class="p">})</span>

<span class="n">distLayer</span> <span class="o">=</span> <span class="n">mm</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Distribution</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="n">dataType</span><span class="p">,</span> <span class="n">regularize_cov_epsilon</span><span class="o">=</span><span class="mf">0.95</span><span class="p">)</span>
<span class="n">dist</span> <span class="o">=</span> <span class="n">distLayer</span><span class="p">(</span><span class="n">newDist</span><span class="p">)</span>
</pre></div>
</div>
<section id="id5">
<h2>Parameters<a class="headerlink" href="#id5" title="Permalink to this heading"></a></h2>
<dl class="simple">
<dt>regularize_cov_epsilon<span class="classifier">python float</span></dt><dd><p>if not None cov matrix corelation is restricted (eg. 0.995)</p>
</dd>
</dl>
</section>
<section id="id6">
<h2>Returns<a class="headerlink" href="#id6" title="Permalink to this heading"></a></h2>
<dl class="simple">
<dt>{</dt><dd><dl class="simple">
<dt>“means”<span class="classifier">Tensorflow Tensor</span></dt><dd><p>Centers of the mixture distributions</p>
</dd>
<dt>“covariances”<span class="classifier">Tensorflow Tensor</span></dt><dd><p>Covariance matrices of the distributions</p>
</dd>
<dt>“weights”<span class="classifier">Tensorflow Tensor</span></dt><dd><p>Weights of the mixture components</p>
</dd>
</dl>
</dd>
</dl>
<p>}</p>
<dl class="py method">
<dt class="sig sig-object py" id="mixturemapping.layers.generalmapping.GeneralMapping.build">
<span class="sig-name descname"><span class="pre">build</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">input_shapes</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mixturemapping.layers.generalmapping.GeneralMapping.build" title="Permalink to this definition"></a></dt>
<dd><p>Creates the variables of the layer (optional, for subclass implementers).</p>
<p>This is a method that implementers of subclasses of <cite>Layer</cite> or <cite>Model</cite>
can override if they need a state-creation step in-between
layer instantiation and layer call. It is invoked automatically before
the first execution of <cite>call()</cite>.</p>
<p>This is typically used to create the weights of <cite>Layer</cite> subclasses
(at the discretion of the subclass implementer).</p>
<dl class="simple">
<dt>Args:</dt><dd><dl class="simple">
<dt>input_shape: Instance of <cite>TensorShape</cite>, or list of instances of</dt><dd><p><cite>TensorShape</cite> if the layer expects a list of inputs
(one instance per input).</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mixturemapping.layers.generalmapping.GeneralMapping.call">
<span class="sig-name descname"><span class="pre">call</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mixturemapping.layers.generalmapping.GeneralMapping.call" title="Permalink to this definition"></a></dt>
<dd><p>Compute the output distribution layer based on <cite>x</cite> (dict of <cite>tf.Tensors</cite>)</p>
<dl>
<dt>Parameters:</dt><dd><dl>
<dt>means: Instance of <cite>tf.Tensor</cite></dt><dd><p>Means <cite>tf.Tensor</cite> of the input mixture distribution
shape: [batch, mix, inDim]</p>
</dd>
<dt>stdDevs: Instance of <cite>tf.Tensor</cite></dt><dd><p>Std Deviation <cite>tf.Tensor</cite> of the input mixture distribution
shape: [batch, mix, inDim]</p>
</dd>
<dt>covariances<span class="classifier">Instance of <cite>tf.Tensor</cite></span></dt><dd><p>Cov Matrix Tensor of the input mixture distribution
shape: [batch, mix, inDim, inDim]</p>
</dd>
<dt>weights: Instance of <cite>tf.Tensor</cite></dt><dd><p>Weight <cite>tf.Tensor</cite> ot the mixture components
shape: [batch, mix]</p>
</dd>
<dt>yModel<span class="classifier">Keras Model</span></dt><dd><p>Keras Model that maps the means tensor to the output tensor
input: [batch, mix, inDim]
output: [batch, mix, outDim]</p>
</dd>
<dt>yDeltaModel<span class="classifier">KerasModel</span></dt><dd><p>Keras Model that maps the means tensor the the output uncertainty
input: [batch, mix, inDim]
output: [batch, mix, outDim]</p>
</dd>
<dt>covA: Instance of <cite>tf.Tensor</cite> [optional]</dt><dd><p>Optional Covariance Matrix to increase distribution spread
shape: [batch, mix, outDim, outDim] if effect is mixture dependent
shape: [batch, outDim, outDim] if effect is mixture independent</p>
</dd>
<dt>covB: Instance of <cite>tf.Tensor</cite> [optional]</dt><dd><p>Second Optional Covariance Matrix to increase distribution spread
shape: [batch, mix, outDim, outDim] if effect is mixture dependent
shape: [batch, outDim, outDim] if effect is mixture independent</p>
</dd>
</dl>
</dd>
<dt>Returns:</dt><dd><dl class="simple">
<dt>means: Instance of <cite>tf.Tensor</cite></dt><dd><p>Means <cite>tf.Tensor</cite> of the output mixture distribution
shape: [batch, mix, outDim]</p>
</dd>
<dt>covariances: Instance of <cite>tf.Tensor</cite></dt><dd><p>Covariance matrix <cite>tf.Tensor</cite> of the output mixture distribution
shape: [batch, mix, outDim, outDim]</p>
</dd>
<dt>weights: Instance of <cite>tf.Tensor</cite></dt><dd><p>Weight <cite>tf.Tensor</cite> ot the mixture components
shape: [batch, mix]</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

</section>
</dd></dl>

</section>
<section id="module-mixturemapping.layers.binyield">
<span id="binning"></span><h1>Binning<a class="headerlink" href="#module-mixturemapping.layers.binyield" title="Permalink to this heading"></a></h1>
<dl class="py class">
<dt class="sig sig-object py" id="mixturemapping.layers.binyield.BinYield">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">BinYield</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mixturemapping.layers.binyield.BinYield" title="Permalink to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">Layer</span></code></p>
<p>Create a keras layer to compute the bin yield.</p>
<p>We use sample points to define the bin structure. Each of the <cite>binN</cite>
bins has <cite>sampleN</cite> sample points with <cite>outN</cite> values. <cite>outN</cite> must 
be the same dimension as the event_shape of the distribution.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>scheme</strong> (<a class="reference internal" href="mixturemapping.html#mixturemapping.binning.BinningScheme" title="mixturemapping.binning.BinningScheme"><em>binning.BinningScheme</em></a>) – The binning scheme we want to apply</p>
</dd>
</dl>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">binLayer</span> <span class="o">=</span> <span class="n">mm</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Binyield</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>
<span class="k">yield</span> <span class="o">=</span> <span class="n">binLayer</span><span class="p">(</span><span class="n">dist</span><span class="p">)</span>
</pre></div>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="mixturemapping.layers.binyield.BinYield.build">
<span class="sig-name descname"><span class="pre">build</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">input_shapes</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mixturemapping.layers.binyield.BinYield.build" title="Permalink to this definition"></a></dt>
<dd><p>Creates the the dist layer.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mixturemapping.layers.binyield.BinYield.call">
<span class="sig-name descname"><span class="pre">call</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mixturemapping.layers.binyield.BinYield.call" title="Permalink to this definition"></a></dt>
<dd><p>Calculate the binned distribution of a tfp.distributions.Distribution</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>x</strong> (<em>tfp.distributions</em><em> [</em><em>batch</em><em>, </em><em>outN</em><em>]</em>) – The distribution</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>The binning result as a tensor</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>tf.Tensor (shape=[batch, binN])</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mixturemapping.layers.binyield.BinYield.compute_output_shape">
<span class="sig-name descname"><span class="pre">compute_output_shape</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">input_shape</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mixturemapping.layers.binyield.BinYield.compute_output_shape" title="Permalink to this definition"></a></dt>
<dd><p>Computes the output shape of the layer.</p>
<p>If the layer has not been built, this method will call build on
the layer. This assumes that the layer will later be used with
inputs that match the input shape provided here.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>input_shape</strong> – Shape tuple (tuple of integers) or list of
shape tuples (one per output tensor of the layer).
Shape tuples can include None for free dimensions,
instead of an integer.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>The output shape tuple.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>tuple</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</section>
<section id="module-mixturemapping.layers.gmrmapping">
<span id="gaussian-mixtures"></span><h1>Gaussian Mixtures<a class="headerlink" href="#module-mixturemapping.layers.gmrmapping" title="Permalink to this heading"></a></h1>
<dl class="py class">
<dt class="sig sig-object py" id="mixturemapping.layers.gmrmapping.ConstGMR">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">ConstGMR</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mixturemapping.layers.gmrmapping.ConstGMR" title="Permalink to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">_GMRmapping</span></code></p>
<p>A constant mapping layer using gaussian mixtures.</p>
<p>This layers can be used if a trained Gaussian mixture of the combined input and output coordinates are available.</p>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mixturemapping</span> <span class="k">as</span> <span class="nn">mm</span>
<span class="kn">from</span> <span class="nn">sklearn.mixture</span> <span class="kn">import</span> <span class="n">GaussianMixture</span>

<span class="n">baseModel</span> <span class="o">=</span> <span class="n">GaussianMixture</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
<span class="n">baseModel</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">combinedSamples</span><span class="p">)</span>

<span class="n">gmr</span> <span class="o">=</span> <span class="n">mm</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">ConstGMR</span><span class="p">(</span>
    <span class="n">output_indices</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
    <span class="n">means</span><span class="o">=</span><span class="n">baseModel</span><span class="o">.</span><span class="n">means_</span><span class="p">,</span>
    <span class="n">covariances</span><span class="o">=</span><span class="n">baseModel</span><span class="o">.</span><span class="n">covariances_</span><span class="p">,</span>
    <span class="n">weights</span><span class="o">=</span><span class="n">baseModel</span><span class="o">.</span><span class="n">weights_</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<section id="id7">
<h2>Parameters<a class="headerlink" href="#id7" title="Permalink to this heading"></a></h2>
<dl class="simple">
<dt>output_indices<span class="classifier">array </span></dt><dd><p>Array of the indices in the following distribution, which will server as output</p>
</dd>
<dt>means<span class="classifier">numpy array </span></dt><dd><p>Means array of the combined mixture distribution
shape: [mix, inDim]</p>
</dd>
<dt>covariances<span class="classifier">numpy array </span></dt><dd><p>Covariances array of the combined mixture distribution
shape: [mix, inDim, inDim]</p>
</dd>
<dt>weights<span class="classifier">numpy array </span></dt><dd><p>Weights array of the combined mixture distribution
shape: [mix]</p>
</dd>
</dl>
</section>
<section id="id8">
<h2>Returns<a class="headerlink" href="#id8" title="Permalink to this heading"></a></h2>
<dl class="simple">
<dt>{</dt><dd><dl class="simple">
<dt>“means”<span class="classifier">Tensorflow Tensor</span></dt><dd><p>Centers of the mixture distributions</p>
</dd>
<dt>“covariances”<span class="classifier">Tensorflow Tensor</span></dt><dd><p>Covariance matrices of the distributions</p>
</dd>
<dt>“weights”<span class="classifier">Tensorflow Tensor</span></dt><dd><p>Weights of the mixture components</p>
</dd>
</dl>
</dd>
</dl>
<p>}</p>
<dl class="py method">
<dt class="sig sig-object py" id="mixturemapping.layers.gmrmapping.ConstGMR.set_gmm">
<span class="sig-name descname"><span class="pre">set_gmm</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">means</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">covariances</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">weights</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mixturemapping.layers.gmrmapping.ConstGMR.set_gmm" title="Permalink to this definition"></a></dt>
<dd><p>Set the initial GMM parameters</p>
<section id="id9">
<h3>Parameters<a class="headerlink" href="#id9" title="Permalink to this heading"></a></h3>
<dl class="simple">
<dt>means<span class="classifier">numpy array </span></dt><dd><p>Means array of the combined mixture distribution
shape: [mix, inDim]</p>
</dd>
<dt>covariances<span class="classifier">numpy array </span></dt><dd><p>Covariances array of the combined mixture distribution
shape: [mix, inDim, inDim]</p>
</dd>
<dt>weights<span class="classifier">numpy array </span></dt><dd><p>Weights array of the combined mixture distribution
shape: [mix]</p>
</dd>
</dl>
</section>
</dd></dl>

</section>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="mixturemapping.layers.gmrmapping.DynamicGMR">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">DynamicGMR</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mixturemapping.layers.gmrmapping.DynamicGMR" title="Permalink to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">_GMRmapping</span></code></p>
<p>A constant mapping layer using gaussian mixtures.</p>
<p>This layers can be used if a trained Gaussian mixture of the combined input and output coordinates is available.
In a further step the model can be also trained on samples.</p>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mixturemapping</span> <span class="k">as</span> <span class="nn">mm</span>
<span class="kn">from</span> <span class="nn">sklearn.mixture</span> <span class="kn">import</span> <span class="n">GaussianMixture</span>

<span class="n">baseModel</span> <span class="o">=</span> <span class="n">GaussianMixture</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
<span class="n">baseModel</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">combinedSamples</span><span class="p">)</span>

<span class="n">gmr</span> <span class="o">=</span> <span class="n">mm</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">DynamicGMR</span><span class="p">(</span>
    <span class="n">output_indices</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
    <span class="n">means</span><span class="o">=</span><span class="n">baseModel</span><span class="o">.</span><span class="n">means_</span><span class="p">,</span>
    <span class="n">covariances</span><span class="o">=</span><span class="n">baseModel</span><span class="o">.</span><span class="n">covariances_</span><span class="p">,</span>
    <span class="n">weights</span><span class="o">=</span><span class="n">baseModel</span><span class="o">.</span><span class="n">weights_</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">transformedDist</span> <span class="o">=</span> <span class="n">gmr</span><span class="p">({</span><span class="s2">&quot;means&quot;</span><span class="p">:</span> <span class="n">inMeans</span><span class="p">,</span> <span class="s2">&quot;covariances&quot;</span><span class="p">:</span> <span class="n">cov</span><span class="p">,</span> <span class="s2">&quot;weights&quot;</span><span class="p">:</span> <span class="n">inWeight</span><span class="p">})</span>

<span class="n">distLayer</span> <span class="o">=</span> <span class="n">mm</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Distribution</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="n">dataType</span><span class="p">,</span> <span class="n">regularize_cov_epsilon</span><span class="o">=</span><span class="mf">0.95</span><span class="p">)</span>
<span class="n">dist</span> <span class="o">=</span> <span class="n">distLayer</span><span class="p">(</span><span class="n">transformedDist</span><span class="p">)</span>

<span class="n">sample_loss</span> <span class="o">=</span> <span class="n">distLayer</span><span class="o">.</span><span class="n">sample_loss</span><span class="p">(</span><span class="n">inTsamples</span><span class="p">)</span>  
</pre></div>
</div>
<section id="id10">
<h2>Parameters<a class="headerlink" href="#id10" title="Permalink to this heading"></a></h2>
<dl class="simple">
<dt>output_indices<span class="classifier">array </span></dt><dd><p>Array of the indices in the following distribution, which will server as output</p>
</dd>
<dt>means<span class="classifier">numpy array </span></dt><dd><p>Means array of the combined mixture distribution
shape: [mix, inDim]</p>
</dd>
<dt>covariances<span class="classifier">numpy array </span></dt><dd><p>Covariances array of the combined mixture distribution
shape: [mix, inDim, inDim]</p>
</dd>
<dt>weights<span class="classifier">numpy array </span></dt><dd><p>Weights array of the combined mixture distribution
shape: [mix]</p>
</dd>
</dl>
</section>
<section id="id11">
<h2>Returns<a class="headerlink" href="#id11" title="Permalink to this heading"></a></h2>
<dl class="simple">
<dt>{</dt><dd><dl class="simple">
<dt>“means”<span class="classifier">Tensorflow Tensor</span></dt><dd><p>Centers of the mixture distributions</p>
</dd>
<dt>“covariances”<span class="classifier">Tensorflow Tensor</span></dt><dd><p>Covariance matrices of the distributions</p>
</dd>
<dt>“weights”<span class="classifier">Tensorflow Tensor</span></dt><dd><p>Weights of the mixture components</p>
</dd>
</dl>
</dd>
</dl>
<p>}</p>
<dl class="py method">
<dt class="sig sig-object py" id="mixturemapping.layers.gmrmapping.DynamicGMR.set_gmm">
<span class="sig-name descname"><span class="pre">set_gmm</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">means</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">covariances</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">weights</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mixturemapping.layers.gmrmapping.DynamicGMR.set_gmm" title="Permalink to this definition"></a></dt>
<dd><p>Set the initial GMM parameters</p>
<section id="id12">
<h3>Parameters<a class="headerlink" href="#id12" title="Permalink to this heading"></a></h3>
<dl class="simple">
<dt>means<span class="classifier">numpy array </span></dt><dd><p>Means array of the combined mixture distribution
shape: [mix, inDim]</p>
</dd>
<dt>covariances<span class="classifier">numpy array </span></dt><dd><p>Covariances array of the combined mixture distribution
shape: [mix, inDim, inDim]</p>
</dd>
<dt>weights<span class="classifier">numpy array </span></dt><dd><p>Weights array of the combined mixture distribution
shape: [mix]</p>
</dd>
</dl>
</section>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mixturemapping.layers.gmrmapping.DynamicGMR.set_gmm_values">
<span class="sig-name descname"><span class="pre">set_gmm_values</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">means</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">covariances</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">weights</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mixturemapping.layers.gmrmapping.DynamicGMR.set_gmm_values" title="Permalink to this definition"></a></dt>
<dd><p>Set the GMM parameters without creating new tensorflow operations</p>
<section id="id13">
<h3>Parameters<a class="headerlink" href="#id13" title="Permalink to this heading"></a></h3>
<dl class="simple">
<dt>means<span class="classifier">numpy array </span></dt><dd><p>Means array of the combined mixture distribution
shape: [mix, inDim]</p>
</dd>
<dt>covariances<span class="classifier">numpy array </span></dt><dd><p>Covariances array of the combined mixture distribution
shape: [mix, inDim, inDim]</p>
</dd>
<dt>weights<span class="classifier">numpy array </span></dt><dd><p>Weights array of the combined mixture distribution
shape: [mix]</p>
</dd>
</dl>
</section>
</dd></dl>

</section>
</dd></dl>

</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="mixturemapping.html" class="btn btn-neutral float-left" title="Mixture Mapping" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Viktor Krückl (viktor@krueckl.de).</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>